# Sakura EmbyBoss Go å¼€å‘æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ Sakura_embyboss çš„ Go è¯­è¨€é‡æ„ç‰ˆæœ¬ï¼Œç”¨äºé€šè¿‡ Telegram Bot ç®¡ç† Emby åª’ä½“æœåŠ¡å™¨ç”¨æˆ·ã€‚

## æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| Telegram Bot | gopkg.in/telebot.v3 | æˆç†Ÿçš„ Telegram Bot æ¡†æ¶ |
| æ•°æ®åº“ | GORM + MySQL | ORM æ¡†æ¶ |
| Web API | Fiber | é«˜æ€§èƒ½ HTTP æ¡†æ¶ |
| å®šæ—¶ä»»åŠ¡ | gocron | å®šæ—¶ä»»åŠ¡è°ƒåº¦ |
| HTTP å®¢æˆ·ç«¯ | resty | ç®€æ´çš„ HTTP å®¢æˆ·ç«¯ |
| æ—¥å¿— | zerolog | é«˜æ€§èƒ½æ—¥å¿—åº“ |
| ç¼“å­˜ | go-cache | å†…å­˜ç¼“å­˜ |
| å›¾ç‰‡ç”Ÿæˆ | gg + freetype | æ’è¡Œæ¦œå›¾ç‰‡ç”Ÿæˆ |

### æ¨¡å—è¯´æ˜

#### internal/config
é…ç½®ç®¡ç†æ¨¡å—ï¼Œæ”¯æŒçƒ­é‡è½½ã€‚

#### internal/bot
Telegram Bot æ¨¡å—ï¼š
- `bot.go`: Bot åˆå§‹åŒ–å’Œä¸»é€»è¾‘
- `handlers/`: å‘½ä»¤å¤„ç†å™¨
- `middleware/`: ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€æƒé™ã€é€Ÿç‡é™åˆ¶ï¼‰
- `keyboards/`: é”®ç›˜æŒ‰é’®å®šä¹‰
- `session/`: ç”¨æˆ·ä¼šè¯çŠ¶æ€ç®¡ç†

#### internal/emby
Emby API å®¢æˆ·ç«¯ï¼š
- `client.go`: æ ¸å¿ƒ API å°è£…
- `playback_stats.go`: æ’­æ”¾ç»Ÿè®¡å’Œå®¡è®¡ API

#### internal/service
ä¸šåŠ¡é€»è¾‘å±‚ï¼š
- `checkin.go`: ç­¾åˆ°æœåŠ¡ï¼ˆæ”¯æŒè¿ç»­ç­¾åˆ°ï¼‰
- `code.go`: æ³¨å†Œç æœåŠ¡
- `red_envelope.go`: çº¢åŒ…æœåŠ¡ï¼ˆæ”¯æŒä¸“å±çº¢åŒ…ï¼‰
- `leaderboard.go`: æ’è¡Œæ¦œæœåŠ¡
- `backup.go`: å¤‡ä»½æœåŠ¡
- `expiry.go`: åˆ°æœŸæ£€æµ‹æœåŠ¡
- `activity.go`: æ´»è·ƒåº¦æ£€æµ‹æœåŠ¡
- `batch.go`: æ‰¹é‡ç”¨æˆ·ç®¡ç†æœåŠ¡

## å·²å®ç°åŠŸèƒ½ï¼ˆ100%ï¼‰

### âœ… ç”¨æˆ·åŠŸèƒ½
- `/start`: å¼€å¯ç”¨æˆ·é¢æ¿
- `/myinfo`: æŸ¥çœ‹ä¸ªäººä¿¡æ¯
- `/count`: åª’ä½“åº“æ•°é‡
- `/red`: å‘çº¢åŒ…ï¼ˆæ™®é€š/ä¸“å±ï¼‰
- `/srank`: ç§¯åˆ†æ’è¡Œæ¦œ
- `/rank`, `/dayrank`, `/weekrank`: æ’­æ”¾æ’è¡Œæ¦œ

### âœ… ç­¾åˆ°ç³»ç»Ÿ
- æ¯æ—¥ç­¾åˆ°è·å–éšæœºç§¯åˆ†
- è¿ç»­ç­¾åˆ°åŠ æˆï¼ˆ3å¤©+2ï¼Œ7å¤©+5ï¼Œ14å¤©+10ï¼Œ30å¤©+15ï¼‰
- æ•°æ®åº“è®°å½•è¿ç»­ç­¾åˆ°å¤©æ•°

### âœ… çº¢åŒ…åŠŸèƒ½
- `/red <é‡‘é¢> <ä¸ªæ•°> [ç¥ç¦è¯­]`: æ™®é€šçº¢åŒ…
- å›å¤æ¶ˆæ¯ + `/red <é‡‘é¢> [ç¥ç¦è¯­]`: ä¸“å±çº¢åŒ…
- æ‹¼æ‰‹æ°”çº¢åŒ…
- ç¾¤ç»„å†…æŠ¢çº¢åŒ…
- è‡ªåŠ¨ç»“ç®—å’Œé€šçŸ¥

### âœ… å®¡è®¡åŠŸèƒ½
- `/auditip <IP> [å¤©æ•°]`: IP åœ°å€å®¡è®¡
- `/auditdevice <è®¾å¤‡å> [å¤©æ•°]`: è®¾å¤‡å®¡è®¡
- `/auditclient <å®¢æˆ·ç«¯> [å¤©æ•°]`: å®¢æˆ·ç«¯å®¡è®¡
- åŸºäº Emby user_usage_stats æ’ä»¶

### âœ… é…ç½®çƒ­é‡è½½
- è¿è¡Œæ—¶ä¿®æ”¹é…ç½®
- è‡ªåŠ¨ä¿å­˜åˆ° config.json
- æ”¯æŒæ·»åŠ /ç§»é™¤ç®¡ç†å‘˜
- æ”¯æŒå¼€å…³åŠŸèƒ½

### âœ… ç®¡ç†å‘˜åŠŸèƒ½
- `/kk <ç”¨æˆ·>`: ç”¨æˆ·ç®¡ç†é¢æ¿
- `/score`, `/coins`: åŠ å‡ç§¯åˆ†
- `/renew <ç”¨æˆ·> <å¤©æ•°>`: è°ƒæ•´åˆ°æœŸæ—¶é—´
- `/rmemby`: åˆ é™¤ç”¨æˆ·
- `/prouser`, `/revuser`: ç™½åå•ç®¡ç†
- `/uranks`, `/days_ranks`, `/week_ranks`: æ’è¡Œæ¦œ

### âœ… Owner ä¸“å±åŠŸèƒ½
- `/config`: é…ç½®é¢æ¿
- `/proadmin`, `/revadmin`: ç®¡ç†å‘˜ç®¡ç†
- `/backup_db`: æ‰‹åŠ¨å¤‡ä»½æ•°æ®åº“
- `/banall`, `/unbanall`: æ‰¹é‡ç¦ç”¨/è§£ç¦
- `/paolu`: è·‘è·¯åˆ é™¤æ‰€æœ‰

### âœ… MoviePilot ç‚¹æ’­
- ç‚¹æ’­ä¸­å¿ƒé¢æ¿
- èµ„æºæœç´¢ï¼ˆæŒ‰åšç§æ•°æ’åºï¼‰
- æ·»åŠ ä¸‹è½½ä»»åŠ¡
- æŸ¥çœ‹ä¸‹è½½è¿›åº¦
- æŒ‰æµé‡è®¡è´¹

### âœ… Web API
- `GET /health`: å¥åº·æ£€æŸ¥
- `GET /status`: è¯¦ç»†çŠ¶æ€
- `GET /api/v1/stats`: ç»Ÿè®¡ä¿¡æ¯
- `GET /api/v1/user/:id`: ç”¨æˆ·ä¿¡æ¯
- `POST /api/v1/webhook/emby`: Emby Webhook
- `POST /api/v1/webhook/favorites`: æ”¶è—åŒæ­¥

### âœ… å•å…ƒæµ‹è¯•
- `internal/config/config_test.go`
- `internal/service/checkin_test.go`
- `internal/database/models/emby_test.go`
- `internal/emby/playback_stats_test.go`

## ç¼–è¯‘å’Œè¿è¡Œ

```bash
# ä¸‹è½½ä¾èµ–
go mod tidy

# è¿è¡Œæµ‹è¯•
go test ./...

# ç¼–è¯‘
go build -o bot ./cmd/bot

# è¿è¡Œ
./bot -c config.json
```

## Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t sakura-embyboss-go .

# ä½¿ç”¨ docker-compose
docker-compose up -d
```

## ä¸ Python ç‰ˆæœ¬å¯¹æ¯”

### å·²å®ŒæˆåŠŸèƒ½ï¼ˆ100%ï¼‰
- æ‰€æœ‰æ ¸å¿ƒå‘½ä»¤å’Œç”¨æˆ·é¢æ¿
- ç­¾åˆ°ã€çº¢åŒ…ã€æ’è¡Œæ¦œ
- æ³¨å†Œç ç®¡ç†
- åˆ°æœŸæ£€æµ‹å’Œæ´»è·ƒåº¦æ£€æµ‹
- MoviePilot ç‚¹æ’­
- æ‰¹é‡ç”¨æˆ·ç®¡ç†
- Web API
- IP/è®¾å¤‡/å®¢æˆ·ç«¯å®¡è®¡
- ä¸“å±çº¢åŒ…
- é…ç½®çƒ­é‡è½½
- å•å…ƒæµ‹è¯•

é¡¹ç›®å·²å®Œå…¨é‡æ„å®Œæˆï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼ ğŸ‰
